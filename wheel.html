<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>卡通点包器</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 90vh;
            font-family: "Comic Sans MS", "Arial Rounded MT Bold", Arial, sans-serif;

            /* 深色卡通背景：深紫 + 粉色柔光 */
            background: radial-gradient(circle at 50% 30%, #55305d, #2b1e36 70%);
        }

        #title {
            position: absolute;
            top: 3vh;
            font-size: 6vh;
            color: #ff88c9;
            text-shadow: 0 0 2vh rgba(255, 150, 200, 0.8);
            font-weight: bold;
        }

        #box {
            width: 40vh;
            height: 40vh;

            /* 深色背景下更亮的卡通内盒 */
            background: #ffe6f4;

            border-radius: 8vh;
            display: flex;
            justify-content: center;
            align-items: center;

            font-size: 34vh;
            font-weight: bold;
            color: #ff4fa5;

            box-shadow: inset 0 0 4vh rgba(255, 130, 180, 0.4),
            0 1vh 4vh rgba(0, 0, 0, 0.6),
            0 0 4vh rgba(255, 160, 210, 0.4);

            position: relative;
            transform: translateY(0);
            transition: transform 0.25s cubic-bezier(.25, 1.5, .35, 1);
        }

        #start {
            position: absolute;
            bottom: 5vh;
            padding: 2vh 6vh;
            border: none;

            background: #ff66b7;
            color: white;

            border-radius: 4vh;

            font-size: 4.5vh;
            font-weight: bold;
            cursor: pointer;

            box-shadow: 0 0.8vh 2vh rgba(255, 100, 160, 0.5),
            inset 0 0 2vh rgba(255, 255, 255, 0.4);

            transition: transform 0.15s ease;
        }

        #start:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body>

<div id="title">卡通点包器</div>
<div id="box">0</div>
<button id="start">开始</button>


<script>
    const box = document.getElementById("box");
    const startBtn = document.getElementById("start");

    let numbers = [];
    let probabilities = [];
    let index = 0;
    let running = false;

    let speed = 200;
    let minSpeed = 100;
    let maxSpeed = 600;

    let target = 3;

    startBtn.disabled = true;
    startBtn.style.background = "#888";
    startBtn.style.cursor = "not-allowed";

    function chooseTarget() {
        const locked = numbers
            .map((num, i) => ({num, isLock: data[i]?.is_lock}))
            .filter(item => item.isLock === 1)
            .map(item => item.num);

        if (locked.length > 0) {
            const idx = Math.floor(Math.random() * locked.length);
            return locked[idx];
        } else {
            return weightedRandom();
        }
    }

    function weightedRandom() {
        let r = Math.random();
        let sum = 0;
        for (let i = 0; i < numbers.length; i++) {
            sum += probabilities[i];
            if (r <= sum) return numbers[i];
        }
        return numbers[numbers.length - 1]; // 兜底
    }

    async function fetchData() {
        try {
            const form = new FormData();
            const res = await fetch('https://gameapi.tuuz.cc:444/v2/doudian/game/wheel', {
                method: 'POST',
                body: form
            });
            const data = await res.json();
            if (Array.isArray(data?.data)) {
                numbers = [];
                probabilities = [];
                data.data.forEach(item => {
                    numbers.push(item.num);
                    probabilities.push(item.ratio);
                });
            }

            startBtn.disabled = false;
            startBtn.style.background = "#ff66b7"; // 恢复原来的颜色
            startBtn.style.cursor = "pointer";
        } catch (e) {
            console.error("接口获取失败", e);
            numbers = [2, 3, 4, 5];
            probabilities = [0.5, 0.25, 0.125, 0.075];

            startBtn.disabled = false;
            startBtn.style.background = "#ff66b7";
            startBtn.style.cursor = "pointer";
        }
    }

    function jump() {
        if (!running) return;

        box.style.transform = "translateY(-10vh)";
        setTimeout(() => {
            box.style.transform = "translateY(0)";
        }, speed * 0.4);

        index = (index + 1) % numbers.length;
        box.textContent = numbers[index];

        if (speed < 240) speed += 24;      // 加速阶段
        else if (speed < maxSpeed) speed += 48; // 减速阶段

        if (speed >= maxSpeed && numbers[index] === target) {
            running = false;
            return;
        }

        setTimeout(jump, speed);
    }

    ''
    startBtn.onclick = () => {
        if (running || startBtn.disabled) return;

        index = 0;
        speed = minSpeed;
        running = true;

        target = chooseTarget();
        jump();

        fetchData();
    };


    window.onload = fetchData;
</script>


</body>
</html>
